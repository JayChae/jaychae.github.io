<!DOCTYPE html><html lang="ko" class="__className_fde3a9 size-full"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/01b1cf11-36f4-4000-b772-ddd9807386d5"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/3e2e70f1-01d9-47c3-94e8-66d7590e9e7a"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/02a58422-76b7-4fe1-92dc-4b438e4c54ad"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/811e6328-4985-4213-878a-24b362a5c340"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/890ae51f-ee3c-404d-b6bf-b2a37ebbe9cf"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/972f5591-a706-4b62-8037-70fe151e0138"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/5fddbef4-ed75-41dc-973f-39b3c283e737"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/fed612ed-6824-43ab-b8eb-2bb21b11c12b"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/b3c8647c-5a34-4a89-a3d6-27de7a5b1b15"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/d3e93958-8e23-46e1-bb9d-823a2070613a"/><link rel="stylesheet" href="/_next/static/css/aa5c0cfdd8dfd8bd.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-2d2dc68beef0c482.js"/><script src="/_next/static/chunks/80433fe4-e24eaad93a1cfb9d.js" async=""></script><script src="/_next/static/chunks/367-0ec4dc94cb811371.js" async=""></script><script src="/_next/static/chunks/main-app-f1b4d9826ef8e891.js" async=""></script><script src="/_next/static/chunks/dd507964-94e7a1153960be03.js" async=""></script><script src="/_next/static/chunks/b706f4b1-2831010e2dd2a749.js" async=""></script><script src="/_next/static/chunks/73dfd616-512978e649b76761.js" async=""></script><script src="/_next/static/chunks/963-4dffbac8d6a25e78.js" async=""></script><script src="/_next/static/chunks/679-d1a6a81af7b7551a.js" async=""></script><script src="/_next/static/chunks/app/layout-eb3ccd7f5c20da6c.js" async=""></script><script src="/_next/static/chunks/app/error-b5faafca2308edb7.js" async=""></script><script src="/_next/static/chunks/app/simple-coin/%5Bid%5D/page-180348f7e7a038cd.js" async=""></script><link rel="preload" as="image" href="https://github.com/user-attachments/assets/e83f7d64-2567-46f0-b81b-776c59ac91bc"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/2f558110-20e9-4a9b-b303-daf7ee0eaaca"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/588c5957-b315-4cf7-a9bf-811a1aef1e64"/><link rel="preload" as="image" href="https://github.com/user-attachments/assets/b3daad70-9a48-409d-a1eb-bcc2243438eb"/><title>블록체인 &amp; 암호화폐 원리와 simple coin 구현 가이드 | JongMin Chae</title><meta name="description" content="JongMin Chae 개인 블록"/><link rel="icon" href="/images/spyglass.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="relative size-full"><header class="fixed top-0 z-50 flex h-12 w-full items-center border-gray-200 bg-white/95 pl-10 backdrop-blur-sm"><div class="flex items-center gap-2"><a href="/"><span>JongMin Chae</span></a><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="size-3" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2z"></path></svg></div></header><div dir="ltr" class="relative overflow-hidden" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="size-full rounded-[inherit]" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><main class="size-full transition-all duration-300 ease-out pl-0 overflow-x-hidden pt-12"><div class="mx-auto max-w-6xl p-8"><article class="prose !max-w-full"><h1>Simple Blockchain NetWork</h1>
<p>다른 노드와 블록을 공유하고 동기화하기 위해 다음과 같은 규칙이 적용합니다.</p>
<p>노드가 새 블록을 생성하면 네트워크에 이를 전파합니다.</p>
<p><img src="https://github.com/user-attachments/assets/01b1cf11-36f4-4000-b772-ddd9807386d5" alt=""/></p>
<p>새로운 노드에 연결하면 최신 블록을 요청합니다. 노드가 현재 알려진 블록보다 인덱스가 큰 블록을 발견하면, 바로 다음 블록으로 추가할 수 있는 경우에는 블록을 추가하고, 바로 추가 할 수 없는 경우 전체 블록체인을 요청합니다.</p>
<p><img src="https://github.com/user-attachments/assets/3e2e70f1-01d9-47c3-94e8-66d7590e9e7a" alt=""/></p>
<h2>P2P</h2>
<p>P2P 통신을 위해 웹소켓(ws)을 사용합니다.</p>
<pre><code class="language-ts">const sockets: WebSocket[]
</code></pre>
<p>각 노드의 활성 소켓은 변수에 저장합니다.
자동 피어 탐색 기능은 사용하지 않으며, 피어의 위치(웹소켓 URL)는 수동으로 추가해야 합니다.</p>
<pre><code class="language-ts">const initP2PServer = () =&gt; {
  const server = new WebSocket.Server({ port: P2P_PORT })

  // 다른 노드가 연결해 온 경우
  server.on(&#x27;connection&#x27;, (ws: WebSocket) =&gt; {
    console.log(&#x27;connected&#x27;, ws)
    // 연결된  노드에 추가
    this.sockets.push(ws)
    // 에러 및 메시지 받았을 경우 handler
    this.initMessageHandler(ws)
    this.initErrorHandler(ws)
    // 연결된 노드에게 최신 블록 정보 요청
    this.write(ws, this.queryChainLengthMsg())
  })
  console.log(&#x27;listening websocket p2p port on: &#x27; + P2P_PORT)
}
</code></pre>
<h3>HTTP</h3>
<p>사용자가 노드를 제어할 수 있도록 이를 HTTP 서버를 설정합니다.</p>
<pre><code class="language-ts">const initHttpServer = (myHttpPort: number) =&gt; {
  const app = express()
  app.use(express.json())

  app.get(&#x27;/blocks&#x27;, (req, res) =&gt; {
    res.send(getBlockchain())
  })
  app.post(&#x27;/mineBlock&#x27;, (req, res) =&gt; {
    const newBlock: Block = generateNextBlock(req.body.data)
    broadcastLatest()
    res.send(newBlock)
  })
  app.get(&#x27;/peers&#x27;, (req, res) =&gt; {
    res.send(
      getSockets().map(
        (s: any) =&gt; s._socket.remoteAddress + &#x27;:&#x27; + s._socket.remotePort,
      ),
    )
  })
  app.post(&#x27;/addPeer&#x27;, (req, res) =&gt; {
    connectToPeer(req.body.peer)
    res.send()
  })

  app.listen(myHttpPort, () =&gt; {
    console.log(&#x27;Listening http on port: &#x27; + myHttpPort)
  })
}
</code></pre>
<ul>
<li>모든 블록 목록 보기: 현재 체인에 포함된 모든 블록을 조회할 수 있습니다.</li>
<li>새 블록 생성: 사용자가 제공한 내용으로 새로운 블록을 생성하여 체인에 추가할 수 있습니다.</li>
<li>피어 목록 보기 또는 추가: 현재 연결된 피어 목록을 확인하거나 새로운 피어를 추가할 수 있습니다.</li>
</ul>
<h2>구조</h2>
<p><img src="https://github.com/user-attachments/assets/02a58422-76b7-4fe1-92dc-4b438e4c54ad" alt="network"/></p>
<h2>블록체인 Flow</h2>
<h3>1. 블록 생성 및 전파 FLOW</h3>
<h4>1.1 node1과 node2 연결된 상황</h4>
<p><img src="https://github.com/user-attachments/assets/811e6328-4985-4213-878a-24b362a5c340" alt="1"/></p>
<h4>1.2 node1에서 블록 생성 후 전파</h4>
<p><img src="https://github.com/user-attachments/assets/890ae51f-ee3c-404d-b6bf-b2a37ebbe9cf" alt="1"/></p>
<h4>1.3 node2에서 블록 받은 후 체인에 추가</h4>
<p><img src="https://github.com/user-attachments/assets/972f5591-a706-4b62-8037-70fe151e0138" alt="1"/></p>
<h3>2. 새로운 노드 연결 FLOW</h3>
<h4>2.1 node3 node2 연결하고 최신 블록 요청</h4>
<p><img src="https://github.com/user-attachments/assets/5fddbef4-ed75-41dc-973f-39b3c283e737" alt="1"/></p>
<h4>2.2 받은 블록의 index가 클 경우 전체 체인 요청</h4>
<p><img src="https://github.com/user-attachments/assets/fed612ed-6824-43ab-b8eb-2bb21b11c12b" alt="1"/></p>
<h4>2.3 받은 블록체인이 자신보다 길고 유효한지 검사 후 체인 교체</h4>
<p><img src="https://github.com/user-attachments/assets/b3c8647c-5a34-4a89-a3d6-27de7a5b1b15" alt="1"/></p>
<h3>3. 충돌 상황(Fork)</h3>
<h4>3.1 같은 index의 블록이 동시에 생성된 상황</h4>
<p><img src="https://github.com/user-attachments/assets/d3e93958-8e23-46e1-bb9d-823a2070613a" alt="1"/></p>
<h4>3.2 node1의 index4 블록을 받은 node2는 아무것도 하지 않는다.</h4>
<p><img src="https://github.com/user-attachments/assets/e83f7d64-2567-46f0-b81b-776c59ac91bc" alt="1"/></p>
<h4>3.3 node3이 새로운 블록을 생성하여 node2가 받고 node1에게 전달, node1은 바로 체인에 추가할 수 있는 블록이 아니기 때문에 전체 체인 요청</h4>
<p><img src="https://github.com/user-attachments/assets/2f558110-20e9-4a9b-b303-daf7ee0eaaca" alt="1"/></p>
<h4>3.4 node1은 node2에게 전체 체인 요청을 받고 더 긴 체인을 선택</h4>
<p><img src="https://github.com/user-attachments/assets/588c5957-b315-4cf7-a9bf-811a1aef1e64" alt="1"/></p>
<p>node1이 생성한 블록 4는 소실된다. 이러한 블록을 고아 블록이라고 한다. 비트코인의 경우 고아 블록 안에 들어 있던 트랜잭션은 다시 미확인 거래 풀(memPool)로 돌아가 이후에 처리 된다. 해당 기능은 구현하지 않습니다.</p>
<h3>3.5 결과</h3>
<p><img src="https://github.com/user-attachments/assets/b3daad70-9a48-409d-a1eb-bcc2243438eb" alt="1"/></p>
<h2>Simple BlockChain</h2>
<p>여기까지가 간단한 블록체인 구현입니다. 블록체인만 구현한 프로젝트인 <a href="https://github.com/JayChae/simple-blockchain">simple-blockchain</a>도 있으니 확인해 보세요</p>
<h2>다음 챕터</h2>
<p>다음 챕터에서는 채굴과 Proof of Work에 대해서 알아보고 구현합니다.</p></article><div class="mt-12 flex items-center justify-between border-t pt-8"><a class="flex items-center gap-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50" href="/simple-coin/blockchain/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left size-4"><path d="m15 18-6-6 6-6"></path></svg>이전 아티클</a><div class="text-sm text-gray-500">2<!-- --> / <!-- -->8</div><a class="flex items-center gap-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50" href="/simple-coin/pow/">다음 아티클<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right size-4"><path d="m9 18 6-6-6-6"></path></svg></a></div></div><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></main></div></div></div><script src="/_next/static/chunks/webpack-2d2dc68beef0c482.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"2:\"$Sreact.fragment\"\n3:I[4752,[\"282\",\"static/chunks/dd507964-94e7a1153960be03.js\",\"533\",\"static/chunks/b706f4b1-2831010e2dd2a749.js\",\"692\",\"static/chunks/73dfd616-512978e649b76761.js\",\"963\",\"static/chunks/963-4dffbac8d6a25e78.js\",\"679\",\"static/chunks/679-d1a6a81af7b7551a.js\",\"177\",\"static/chunks/app/layout-eb3ccd7f5c20da6c.js\"],\"SidebarProvider\"]\n4:I[9474,[\"282\",\"static/chunks/dd507964-94e7a1153960be03.js\",\"533\",\"static/chunks/b706f4b1-2831010e2dd2a749.js\",\"692\",\"static/chunks/73dfd616-512978e649b76761.js\",\"963\",\"static/chunks/963-4dffbac8d6a25e78.js\",\"679\",\"static/chunks/679-d1a6a81af7b7551a.js\",\"177\",\"static/chunks/app/layout-eb3ccd7f5c20da6c.js\"],\"default\"]\n5:I[622,[\"282\",\"static/chunks/dd507964-94e7a1153960be03.js\",\"533\",\"static/chunks/b706f4b1-2831010e2dd2a749.js\",\"692\",\"static/chunks/73dfd616-512978e649b76761.js\",\"963\",\"static/chunks/963-4dffbac8d6a25e78.js\",\"679\",\"static/chunks/679-d1a6a81af7b7551a.js\",\"177\",\"static/chunks/app/layout-eb3ccd7f5c20da6c.js\"],\"default\"]\n6:I[4752,[\"282\",\"static/chunks/dd507964-94e7a1153960be03.js\",\"533\",\"static/chunks/b706f4b1-2831010e2dd2a749.js\",\"692\",\"static/chunks/73dfd616-512978e649b76761.js\",\"963\",\"static/chunks/963-4dffbac8d6a25e78.js\",\"679\",\"static/chunks/679-d1a6a81af7b7551a.js\",\"177\",\"static/chunks/app/layout-eb3ccd7f5c20da6c.js\"],\"Main\"]\n7:I[7059,[],\"\"]\n8:I[3333,[\"39\",\"static/chunks/app/error-b5faafca2308edb7.js\"],\"default\"]\n9:I[646,[],\"\"]\nb:I[3713,[],\"OutletBoundary\"]\nd:I[3713,[],\"MetadataBoundary\"]\nf:I[3713,[],\"ViewportBoundary\"]\n11:I[9359,[],\"\"]\n1:HL[\"/_next/static/css/aa5c0cfdd8dfd8bd.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Yf5GZIQzHMcvX3HNUihRz\",\"p\":\"\",\"c\":[\"\",\"simple-coin\",\"network\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"simple-coin\",{\"children\":[[\"id\",\"network\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$2\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/aa5c0cfdd8dfd8bd.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"className\":\"__className_fde3a9 size-full\",\"children\":[\"$\",\"body\",null,{\"className\":\"relative size-full\",\"children\":[\"$\",\"$L3\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"fixed top-0 z-50 flex h-12 w-full items-center border-gray-200 bg-white/95 pl-10 backdrop-blur-sm\",\"children\":[\"$\",\"$L4\",null,{\"children\":[\"$\",\"span\",null,{\"children\":\"JongMin Chae\"}]}]}],[\"$\",\"$L5\",null,{}],[\"$\",\"$L6\",null,{\"className\":\"overflow-x-hidden pt-12\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$8\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}]]}]}]}]]}],{\"children\":[\"simple-coin\",[\"$\",\"$2\",\"c\",{\"children\":[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"simple-coin\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"network\",\"d\"],[\"$\",\"$2\",\"c\",{\"children\":[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"simple-coin\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$2\",\"c\",{\"children\":[\"$La\",null,[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}]]}],{},null]},null]},null]},null],[\"$\",\"$2\",\"h\",{\"children\":[null,[\"$\",\"$2\",\"IlHQC1lQTBcJSq1_neeLS\",{\"children\":[[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:I[4963,[\"963\",\"static/chunks/963-4dffbac8d6a25e78.js\",\"713\",\"static/chunks/app/simple-coin/%5Bid%5D/page-180348f7e7a038cd.js\"],\"\"]\n13:I[4931,[\"963\",\"static/chunks/963-4dffbac8d6a25e78.js\",\"713\",\"static/chunks/app/simple-coin/%5Bid%5D/page-180348f7e7a038cd.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-6xl p-8\",\"children\":[[\"$\",\"article\",null,{\"className\":\"prose !max-w-full\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Simple Blockchain NetWork\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"다른 노드와 블록을 공유하고 동기화하기 위해 다음과 같은 규칙이 적용합니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"노드가 새 블록을 생성하면 네트워크에 이를 전파합니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/01b1cf11-36f4-4000-b772-ddd9807386d5\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"새로운 노드에 연결하면 최신 블록을 요청합니다. 노드가 현재 알려진 블록보다 인덱스가 큰 블록을 발견하면, 바로 다음 블록으로 추가할 수 있는 경우에는 블록을 추가하고, 바로 추가 할 수 없는 경우 전체 블록체인을 요청합니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/3e2e70f1-01d9-47c3-94e8-66d7590e9e7a\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"P2P\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"P2P 통신을 위해 웹소켓(ws)을 사용합니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-ts\",\"children\":\"const sockets: WebSocket[]\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"각 노드의 활성 소켓은 변수에 저장합니다.\\r\\n자동 피어 탐색 기능은 사용하지 않으며, 피어의 위치(웹소켓 URL)는 수동으로 추가해야 합니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-ts\",\"children\":\"const initP2PServer = () =\u003e {\\r\\n  const server = new WebSocket.Server({ port: P2P_PORT })\\r\\n\\r\\n  // 다른 노드가 연결해 온 경우\\r\\n  server.on('connection', (ws: WebSocket) =\u003e {\\r\\n    console.log('connected', ws)\\r\\n    // 연결된  노드에 추가\\r\\n    this.sockets.push(ws)\\r\\n    // 에러 및 메시지 받았을 경우 handler\\r\\n    this.initMessageHandler(ws)\\r\\n    this.initErrorHandler(ws)\\r\\n    // 연결된 노드에게 최신 블록 정보 요청\\r\\n    this.write(ws, this.queryChainLengthMsg())\\r\\n  })\\r\\n  console.log('listening websocket p2p port on: ' + P2P_PORT)\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"HTTP\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"사용자가 노드를 제어할 수 있도록 이를 HTTP 서버를 설정합니다.\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-ts\",\"children\":\"const initHttpServer = (myHttpPort: number) =\u003e {\\r\\n  const app = express()\\r\\n  app.use(express.json())\\r\\n\\r\\n  app.get('/blocks', (req, res) =\u003e {\\r\\n    res.send(getBlockchain())\\r\\n  })\\r\\n  app.post('/mineBlock', (req, res) =\u003e {\\r\\n    const newBlock: Block = generateNextBlock(req.body.data)\\r\\n    broadcastLatest()\\r\\n    res.send(newBlock)\\r\\n  })\\r\\n  app.get('/peers', (req, res) =\u003e {\\r\\n    res.send(\\r\\n      getSockets().map(\\r\\n        (s: any) =\u003e s._socket.remoteAddress + ':' + s._socket.remotePort,\\r\\n      ),\\r\\n    )\\r\\n  })\\r\\n  app.post('/addPeer', (req, res) =\u003e {\\r\\n    connectToPeer(req.body.peer)\\r\\n    res.send()\\r\\n  })\\r\\n\\r\\n  app.listen(myHttpPort, () =\u003e {\\r\\n    console.log('Listening http on port: ' + myHttpPort)\\r\\n  })\\r\\n}\\n\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"모든 블록 목록 보기: 현재 체인에 포함된 모든 블록을 조회할 수 있습니다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"새 블록 생성: 사용자가 제공한 내용으로 새로운 블록을 생성하여 체인에 추가할 수 있습니다.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"피어 목록 보기 또는 추가: 현재 연결된 피어 목록을 확인하거나 새로운 피어를 추가할 수 있습니다.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"구조\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/02a58422-76b7-4fe1-92dc-4b438e4c54ad\",\"alt\":\"network\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"블록체인 Flow\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"1. 블록 생성 및 전파 FLOW\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"1.1 node1과 node2 연결된 상황\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/811e6328-4985-4213-878a-24b362a5c340\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"1.2 node1에서 블록 생성 후 전파\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/890ae51f-ee3c-404d-b6bf-b2a37ebbe9cf\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"1.3 node2에서 블록 받은 후 체인에 추가\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/972f5591-a706-4b62-8037-70fe151e0138\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2. 새로운 노드 연결 FLOW\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"2.1 node3 node2 연결하고 최신 블록 요청\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/5fddbef4-ed75-41dc-973f-39b3c283e737\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"2.2 받은 블록의 index가 클 경우 전체 체인 요청\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/fed612ed-6824-43ab-b8eb-2bb21b11c12b\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"2.3 받은 블록체인이 자신보다 길고 유효한지 검사 후 체인 교체\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/b3c8647c-5a34-4a89-a3d6-27de7a5b1b15\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3. 충돌 상황(Fork)\"}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"3.1 같은 index의 블록이 동시에 생성된 상황\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/d3e93958-8e23-46e1-bb9d-823a2070613a\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"3.2 node1의 index4 블록을 받은 node2는 아무것도 하지 않는다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/e83f7d64-2567-46f0-b81b-776c59ac91bc\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"3.3 node3이 새로운 블록을 생성하여 node2가 받고 node1에게 전달, node1은 바로 체인에 추가할 수 있는 블록이 아니기 때문에 전체 체인 요청\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/2f558110-20e9-4a9b-b303-daf7ee0eaaca\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h4\",null,{\"children\":\"3.4 node1은 node2에게 전체 체인 요청을 받고 더 긴 체인을 선택\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/588c5957-b315-4cf7-a9bf-811a1aef1e64\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"node1이 생성한 블록 4는 소실된다. 이러한 블록을 고아 블록이라고 한다. 비트코인의 경우 고아 블록 안에 들어 있던 트랜잭션은 다시 미확인 거래 풀(memPool)로 돌아가 이후에 처리 된다. 해당 기능은 구현하지 않습니다.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3.5 결과\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"https://github.com/user-attachments/assets/b3daad70-9a48-409d-a1eb-bcc2243438eb\",\"alt\":\"1\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Simple BlockChain\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"여기까지가 간단한 블록체인 구현입니다. 블록체인만 구현한 프로젝트인 \",[\"$\",\"a\",null,{\"href\":\"https://github.com/JayChae/simple-blockchain\",\"children\":\"simple-blockchain\"}],\"도 있으니 확인해 보세요\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"다음 챕터\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"다음 챕터에서는 채굴과 Proof of Work에 대해서 알아보고 구현합니다.\"}]]}],[\"$\",\"div\",null,{\"className\":\"mt-12 flex items-center justify-between border-t pt-8\",\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/simple-coin/blockchain\",\"className\":\"flex items-center gap-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-left size-4\",\"children\":[[\"$\",\"path\",\"1wnfg3\",{\"d\":\"m15 18-6-6 6-6\"}],\"$undefined\"]}],\"이전 아티클\"]}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-500\",\"children\":[2,\" / \",8]}],[\"$\",\"$L12\",null,{\"href\":\"/simple-coin/pow\",\"className\":\"flex items-center gap-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50\",\"children\":[\"다음 아티클\",[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-right size-4\",\"children\":[[\"$\",\"path\",\"mthhwq\",{\"d\":\"m9 18 6-6-6-6\"}],\"$undefined\"]}]]}]]}]]}],[\"$\",\"$L13\",null,{}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\ne:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"블록체인 \u0026 암호화폐 원리와 simple coin 구현 가이드 | JongMin Chae\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"JongMin Chae 개인 블록\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/images/spyglass.png\"}]]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script></body></html>